<!doctype html>
  <head>
    <title>CSV Report Generator</title>
  </head>
  <body>
    <form id="json-submission" enctype="multipart/form-data">
      <input type="file" class="file" /><br>
      <input type="submit" />
    </form>
    <div id="csv-report" style="white-space: pre-line"></div>
    <button id="download" hidden>Download report</button>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- <script>src="app.js"</script> -->
    <script>
      $('#json-submission').submit(function(e) {
        e.preventDefault();
        var form = $('.file')[0];
        var file = form.files[0];
        var formData = new FormData();
        formData.append('file', file);
        $.ajax({
          type: 'POST',
          data: formData,
          url: '/',
          cache: false,
          contentType: false,
          processData: false,
          success: (data) => {
            $('#csv-report').empty().append(data);
            $('#download').show();
          }
        });
      });
      </script>
      <script>
        $('#download').click(function(e) {
          e.preventDefault();
          $.ajax({
            type: 'GET',
            url: '/download',
            success: (data) => {
              var blob = new Blob([data]);
              var link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download = "convertedJSON.csv";
              link.click();
            }
          });
        });
      </script>
</body>
</html>